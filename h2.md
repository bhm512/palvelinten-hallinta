# h2 Infraa koodina

## Tiivistelmä:

- Ensimäisessä artikkellissa käydään läpi saltin konfiguraationhallinta järjestelmää. 
- Hello funktiolla kirjoitetaan state, joka varmistaa että tiedosto on jo olemassa ja sisältää jotain.
- YAML on monien saltissa käytettyjen tiedostojen oletusrenderöinti.
- YAML rendröijän tehtävänä on ottaa YAML tietorakenne ja muuttaa se Python tietorakenteeksi salttia varten.
- YAML koostuu kolmesta perustyypistä: scalars, lists ja dicktionaries.
- YAML on järjestetty lohkorakenteisiin, sisennys asettaa kontekstin (vakio kaksi välilyöntiä)
- Kokoelma, joka on luettelo osoittaa jokaisen merkinnän "-" ja välilyönnillä.


## a

Ensinmäisessä kohdassa menin cd /srv/salt/hello/ kansioon ja loin init.sls tiedoston. 

Seuraavaksi testasin sudo salt-call --local state.apply hello komentoa 

<img width="1085" height="449" alt="Näyttökuva 2025-10-30 kello 14 12 53" src="https://github.com/user-attachments/assets/4a98c37c-099e-471f-837f-854ae8dff3c5" /> 

Nyt on tyhjä tiedosto luotu onnistuneesti, koska changed=1. 

## b

Toisessa kohdassa tarkoituksena luoda top.sls tiedosto ja sen luonti onnistuu komennolla sudo nano /srv/salt/top.sls

<img width="765" height="366" alt="Näyttökuva 2025-10-30 kello 16 29 19" src="https://github.com/user-attachments/assets/afbe3ab7-2895-465b-9637-559257679831" />

Oma top.sls tiedostoni sisältää vain yhden rivin - hello, tällä top.fileni näytti tältä 

<img width="523" height="304" alt="Näyttökuva 2025-10-30 kello 16 27 57" src="https://github.com/user-attachments/assets/e813ad25-7e4d-428c-bc43-681e0197d1af" />

## c 

pkg komento suoritettiin /srv/salt/hellopkg/init.sls komennolla ja testattiin sudo salt-call --local state.apply hellopkg 


<img width="638" height="355" alt="Näyttökuva 2025-10-31 kello 0 15 11" src="https://github.com/user-attachments/assets/dc3bc5fb-d961-4eda-843b-ecffb26c6fc2" />


Seuraavaksi testaisin service toimintoa komennolla srv/salt/helloservice/init.sls, tuossa näkyvä testi tulos komennolla sudo salt-call --local state.apply helloservice

<img width="728" height="343" alt="Näyttökuva 2025-10-31 kello 0 21 34" src="https://github.com/user-attachments/assets/4e1f2b1e-9eb5-49b1-9d39-8980218cf157" />

Seuraavana user komento, jota en osannut käyttää. Tai osasin mutta en saanut sitä toimimaan. Loin tiedoston komennolla /srv/salt/hellofile/init.sls 
Komento epäonnistui, koska invalid arguments


<img width="945" height="328" alt="Näyttökuva 2025-10-31 kello 0 26 11" src="https://github.com/user-attachments/assets/1dfcfde1-cbcb-4885-8442-50fd24fa24d6" />


Seuraavaksi kokeilin cmd komentoa, menin hellocmd kansioon ja loin tiedoston /srv/salt/hellocmd/init.sls komennolla. 

<img width="817" height="528" alt="Näyttökuva 2025-10-31 kello 11 31 14" src="https://github.com/user-attachments/assets/99395122-bfd7-4f18-bead-a728ef11e303" />

Tämä onnistui, koska changed=1



## d 


Viimeisessä kohdassa loin erillisen demo tiedoston, jonka myöhemmin voi lisätä top.fileen (top.sls) Tehtävässä piti luoda erillinen sls tiedosto, jossa vähintään kaksi toimintoa.
Loin tiedoston, jossa ensimmäisessä vaiheessa salt tarkastaa onko apache2 asennettu. Seuraavaksi se varmistaa onko apache2 päällä, jos ei se käynnistää sen. Kolmas kohta harjoitukseen
oli logirivin lisääminen tiedostoon. Alla tiedoston sisältö:


<img width="743" height="454" alt="Näyttökuva 2025-10-31 kello 12 55 42" src="https://github.com/user-attachments/assets/ba406cda-76a0-4c3e-8561-91b94a6f694a" />


Tässä vielä ajot, jotka kertovat että tiedosto on idempotentti 



<img width="791" height="734" alt="Näyttökuva 2025-10-31 kello 13 03 11" src="https://github.com/user-attachments/assets/edf4f495-ea62-4f96-87af-847153b49e76" />



<img width="713" height="652" alt="Näyttökuva 2025-10-31 kello 13 02 01" src="https://github.com/user-attachments/assets/f5919724-58f8-4afe-b266-0414f6a8700e" />

Lopuksi lisäsin demo tiedoston vielä top.sls sisälle, jotta sudo salt-call --local state.apply komennolla voisi ajaa kaikki tilat. 


## Lähteet

https://terokarvinen.com/palvelinten-hallinta/ 

https://terokarvinen.com/2024/hello-salt-infra-as-code/

https://docs.saltproject.io/salt/user-guide/en/latest/topics/overview.html#rules-of-yaml

https://docs.saltproject.io/salt/user-guide/en/latest/topics/overview.html#yaml-simple-structure

https://docs.saltproject.io/salt/user-guide/en/latest/topics/overview.html#lists-and-dictionaries-yaml-block-structures

https://docs.saltproject.io/en/latest/ref/states/top.html 

https://docs.saltproject.io/en/latest/ref/states/top.html#multiple-environments 

https://chatgpt.com/?oai-dm=1 (oman ymmärryksen lisäämiseksi) 



