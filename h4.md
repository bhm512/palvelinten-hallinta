# h4

## Muistiinpanot:

- Voit hallita valtavaa määrää daemoneja konfiguraationhallintajärjestelmällä (packet-file-service)
- Tätä tehdessä, asenna ohjelmisto, korvaa konfiguraatiotiedosto ja lopuksi käynnistä daemon uudelleen uuden konfiguraation käyttämiseksi.

## a

Alkuun menin muokkaamaan ssh-palvelimen asetuksia: /etc/ssh/sshd_config ja siellä muokkasin tiedostoa lisäämällä sinne portit 22 ja 2222.
Kun olin lisännyt portit käynnistin ssh-palvelimen uudestaan komennolla: sudo systemctl restart sshd ja tarkistin että portit kuuntelevat.


<img width="941" height="229" alt="Näyttökuva 2025-11-12 kello 19 44 51" src="https://github.com/user-attachments/assets/d48fbbd6-3f41-4d0c-a8d2-c839306a2b5f" />


Kun olin tämän tehnyt, kokeilin käsin että portit toimivat halutulla tavalla molemmissa päissä. 


<img width="994" height="215" alt="Näyttökuva 2025-11-14 kello 19 25 38" src="https://github.com/user-attachments/assets/718e7daf-e109-4794-a6f6-e1f45e78a4bc" />

Seuraavaksi muokkasin SSH:n konfiguraatio tiedostoa ja lisäsin sinne seuraavat asiat: paketin asennus/varmistus, sshd palvelun käynnissä pitäminen ja asetustiedoston hallinta. 
Ensimmäisellä testi kerralla törmäsin ongelmaan, mutta se oli pelkkä merkkivirhe tiedostossa.


<img width="461" height="485" alt="Näyttökuva 2025-11-14 kello 19 40 13" src="https://github.com/user-attachments/assets/397926f7-68cc-4cba-b195-8db043b71b2c" />


Seuraavaksi listasin avaimet ja hyväyksin uuden avaimen, poistin myös vanhan avaimen samalla. Hyväyksin uduet avaimet komenolla sudo salt-key -A


<img width="513" height="459" alt="Näyttökuva 2025-11-14 kello 19 55 54" src="https://github.com/user-attachments/assets/7906e5d3-03e1-4a4c-a029-2d92c9656e25" />

Tässä vielä ajettu tiedosto:


<img width="491" height="770" alt="Näyttökuva 2025-11-14 kello 20 10 52" src="https://github.com/user-attachments/assets/ed66798b-27d4-401f-ad39-bd74618a4922" />

Seuraavaksi testasin onko tiedostoni idempotentti, sillä ensin poistan portin 2222 komennolla: sudo sed -i '/Port 2222/d' /etc/ssh/sshd_config ja ajoin sen heti sen jälkeen uudelleen komenolla: sudo salt '*' state.apply ssh

<img width="610" height="794" alt="Näyttökuva 2025-11-14 kello 20 16 41" src="https://github.com/user-attachments/assets/def824ac-18be-46db-ab16-b02bfb65be6d" />

Tässä osoitus siitä, että tiedosto toimii, sillä sinne lisättiin automaattisesti portti 2222 uudelleen. Se toimi. 

Loppuun vielä (ehkä turha) kuva uudelleen ajetusta tiedostosta, jossa en tehnyt muutoksia, sekin toimi.


<img width="550" height="640" alt="Näyttökuva 2025-11-14 kello 20 19 13" src="https://github.com/user-attachments/assets/90674e3f-aa79-486b-bedd-e571b85c0d13" />

## Lähteet

https://terokarvinen.com/2018/04/03/pkg-file-service-control-daemons-with-salt-change-ssh-server-port/?fromSearch=karvinen%20salt%20ssh

https://terokarvinen.com/palvelinten-hallinta/#h4-pkg-file-service
